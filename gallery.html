<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Gallery of Baluch Martyrs - Browse our memorial database">
    <title>Martyrs Gallery - Baluch Martyrs Memorial</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/chatbot.css">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" sizes="any">
    <link rel="shortcut icon" type="image/svg+xml" href="/favicon.svg">
    
    <!-- Professional Static Asset Refresh System -->
    <script src="js/asset-refresh.js"></script>
</head>
<body>
    <!-- Header Section -->
    <header class="site-header">
        <nav class="navbar">
            <div class="container">
                <div class="nav-brand">
                    <h1>Baluch Martyrs Memorial</h1>
                </div>
                <ul class="nav-menu">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="add-martyr.html">Add Martyr</a></li>
                    <li><a href="gallery.html" class="active">Gallery</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="contact.html">Contact</a></li>
                    <li><button type="button" class="theme-toggle" data-theme-toggle aria-label="Toggle dark mode">üåô</button></li>
                </ul>
                <div class="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main>
        <section class="gallery-section">
            <div class="container">
                <div class="page-header">
                    <h2>Martyrs Gallery</h2>
                    <p>Browse through our memorial database to honor and remember our heroes</p>
                </div>

                <!-- Search/Filter Bar -->
                <div class="filter-bar">
                    <div class="search-controls">
                        <div class="search-input-group">
                            <input type="text" id="searchMartyrs" placeholder="Search by name, location, or organization...">
                            <button type="button" id="clearSearch" title="Clear search">√ó</button>
                        </div>
                        <button type="button" id="toggleAdvancedSearch" class="btn-small">Advanced Search</button>
                    </div>
                    
                    <!-- Advanced Search Panel -->
                    <div id="advancedSearchPanel" class="advanced-search-panel" style="display: none;">
                        <div class="search-row">
                            <div class="search-field">
                                <label for="searchByName">Name:</label>
                                <input type="text" id="searchByName" placeholder="Search by martyr name...">
                            </div>
                            <div class="search-field">
                                <label for="searchByFather">Father's Name:</label>
                                <input type="text" id="searchByFather" placeholder="Father's name...">
                            </div>
                        </div>
                        <div class="search-row">
                            <div class="search-field">
                                <label for="searchByLocation">Location:</label>
                                <input type="text" id="searchByLocation" placeholder="Birth or martyrdom place...">
                            </div>
                            <div class="search-field">
                                <label for="searchByOrganization">Organization:</label>
                                <input type="text" id="searchByOrganization" placeholder="Organization or group...">
                            </div>
                        </div>
                        <div class="search-row">
                            <div class="search-field">
                                <label for="searchByYear">Year:</label>
                                <input type="number" id="searchByYear" placeholder="Martyrdom year" min="1900" max="2030">
                            </div>
                        </div>
                        <div class="search-actions">
                            <button type="button" id="applyAdvancedSearch" class="btn-small">Apply Filters</button>
                            <button type="button" id="clearAdvancedSearch" class="btn-small btn-outline">Clear All</button>
                        </div>
                    </div>
                    
                    <!-- Search Results Info -->
                    <div id="searchResultsInfo" class="search-results-info" style="display: none;">
                        <span id="resultsCount">0</span> <span id="resultsLabel">martyrs found</span>
                        <span id="resultsFilters" class="results-filters"></span>
                        <button type="button" id="clearAllFilters" class="clear-filters-btn">Clear filters</button>
                    </div>
                </div>

                <!-- Gallery Grid -->
                <div class="gallery-grid" id="galleryGrid">
                    <!-- Professional loading state will be shown by JavaScript -->
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Baluch Martyrs Memorial</h3>
                    <p>Preserving the memory of our heroes who gave their lives for freedom.</p>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="add-martyr.html">Add Martyr</a></li>
                        <li><a href="gallery.html">Gallery</a></li>
                        <li><a href="about.html">About</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Contact</h3>
                    <p>Email: info@baluchmemorial.org</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Baluch Martyrs Memorial. All rights reserved.</p>
                <p>Data managed by <strong>Baloch Martyrs Committee</strong> ‚Ä¢ Powered by <strong>Benjamin Baluch</strong></p>
            </div>
        </div>
    </footer>

    <!-- Firebase SDK - Direct CDN Loading -->
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>
    
    <!-- Load gallery.js first to ensure functions are available -->
    <script src="js/main.js"></script>
    <script src="js/mobile-menu.js"></script>
    <script src="js/chatbot.js"></script>
    <script src="js/gallery.js"></script>
    
    <script>
        // DIRECT Firebase Initialization - Production Ready
        console.log('üî• Initializing Firebase directly...');
        
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBW2JKt68kGKE-CMvKQUUj33ToZ8M-kGII",
            authDomain: "baluch-martyrs-memorial.firebaseapp.com",
            projectId: "baluch-martyrs-memorial",
            storageBucket: "baluch-martyrs-memorial.firebasestorage.app",
            messagingSenderId: "420195314966",
            appId: "1:420195314966:web:0e3546e6e0e0c09cf3f437"
        };
        
        // Initialize Firebase
        let app, db;
        
        try {
            app = firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            console.log('‚úÖ Firebase initialized successfully');
            
            // Create global Firebase helper
            window.firebaseDB = {
                async getApprovedMartyrs() {
                    try {
                        console.log('üîç Fetching martyrs from Firebase...');
                        
                        // Try martyrs collection first
                        const martyrsRef = db.collection('martyrs');
                        const snapshot = await martyrsRef.get();
                        let martyrs = [];
                        
                        snapshot.forEach(doc => {
                            const data = doc.data();
                            if (!data.status || data.status === 'approved') {
                                martyrs.push({
                                    id: doc.id,
                                    ...data,
                                    status: data.status || 'approved'
                                });
                            }
                        });
                        
                        console.log(`‚úÖ Found ${martyrs.length} martyrs in Firebase`);
                        
                        // If no martyrs, just return an empty list ‚Äì do NOT auto-add demo data
                        if (martyrs.length === 0) {
                            console.log('üì≠ No martyrs found in Firebase martyrs collection. Returning empty list.');
                        }
                        
                        return { success: true, data: martyrs };
                        
                    } catch (error) {
                        console.error('‚ùå Firebase error:', error);
                        return { success: false, error: error.message };
                    }
                }
            };
            
            // Load data immediately
            window.firebaseDB.getApprovedMartyrs().then(result => {
                if (result.success) {
                    console.log(`üé® Gallery ready: ${result.data.length} martyrs`);
                    
                    // Store globally
                    window.martyrsDataFromFirebase = result.data;
                    
                    // Cache to localStorage
                    try {
                        localStorage.setItem('martyrsData', JSON.stringify(result.data));
                        localStorage.setItem('martyrsData_timestamp', Date.now().toString());
                    } catch (e) {
                        console.warn('LocalStorage cache failed:', e);
                    }
                    
                    // Trigger gallery load
                    window.dispatchEvent(new CustomEvent('martyrsDataReady', { 
                        detail: { 
                            data: result.data, 
                            source: 'Firebase',
                            connected: true
                        } 
                    }));
                } else {
                    console.error('‚ùå Firebase data loading failed:', result.error);
                    
                    // Try localStorage fallback
                    const saved = localStorage.getItem('martyrsData');
                    if (saved) {
                        try {
                            const data = JSON.parse(saved);
                            const approved = data.filter(m => !m.status || m.status === 'approved');
                            console.log(`üíæ Using localStorage: ${approved.length} martyrs`);
                            
                            window.martyrsDataFromFirebase = approved;
                            window.dispatchEvent(new CustomEvent('martyrsDataReady', { 
                                detail: { 
                                    data: approved, 
                                    source: 'localStorage',
                                    connected: false
                                } 
                            }));
                        } catch (e) {
                            console.error('‚ùå LocalStorage fallback failed:', e);
                            window.dispatchEvent(new CustomEvent('martyrsDataReady', { 
                                detail: { 
                                    data: [], 
                                    source: 'failed',
                                    connected: false,
                                    error: result.error
                                } 
                            }));
                        }
                    } else {
                        window.dispatchEvent(new CustomEvent('martyrsDataReady', { 
                            detail: { 
                                data: [], 
                                source: 'failed',
                                connected: false,
                                error: result.error
                            } 
                        }));
                    }
                }
            });
            
        } catch (error) {
            console.error('‚ùå Firebase initialization failed:', error);
            
            // Try localStorage as final fallback
            const saved = localStorage.getItem('martyrsData');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    const approved = data.filter(m => !m.status || m.status === 'approved');
                    console.log(`üíæ Emergency localStorage: ${approved.length} martyrs`);
                    
                    window.martyrsDataFromFirebase = approved;
                    window.dispatchEvent(new CustomEvent('martyrsDataReady', { 
                        detail: { 
                            data: approved, 
                            source: 'localStorage',
                            connected: false
                        } 
                    }));
                } catch (e) {
                    console.error('‚ùå All data loading failed');
                    window.dispatchEvent(new CustomEvent('martyrsDataReady', { 
                        detail: { 
                            data: [], 
                            source: 'failed',
                            connected: false,
                            error: error.message
                        } 
                    }));
                }
            } else {
                window.dispatchEvent(new CustomEvent('martyrsDataReady', { 
                    detail: { 
                        data: [], 
                        source: 'failed',
                        connected: false,
                        error: error.message
                    } 
                }));
            }
        }
        
    </script>

    <!-- Initialize Professional Asset Refresh System -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        if (typeof StaticAssetRefresh !== 'undefined') {
            try {
                window.initAutoRefresh({
                    enableLogging: false,
                    refreshInterval: 30 * 60 * 1000,
                    cookiePrefix: 'bmm_cache_',
                    autoRefresh: true
                });
                
                window.forceRefreshAssets = async function() {
                    const results = await window.refreshStaticAssets({ enableLogging: true });
                    console.log('‚úÖ Gallery assets refreshed:', results);
                    return results;
                };
            } catch (error) {
                console.warn('‚ö†Ô∏è Asset refresh failed:', error);
            }
        }
    });
    </script>
</body>
</html>
